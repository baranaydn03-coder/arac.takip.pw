<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Araç Takip</title>
<link rel="manifest" href="manifest.json">
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
input, button { padding: 8px; margin: 5px 0; width: 100%; max-width: 400px; }
ul { list-style-type: none; padding: 0; }
li { margin: 10px 0; border: 1px solid #ccc; padding: 10px; border-radius: 5px; }
</style>
</head>
<body>
<h1>Araç Takip</h1>

<h3>Yeni Araç Ekle</h3>
<input type="text" id="aracAdi" placeholder="Araç Adı (Opsiyonel)">
<input type="text" id="plaka" placeholder="Plaka">
<input type="date" id="baslangicTarih" placeholder="Başlangıç Tarihi (Opsiyonel)">
<input type="date" id="bitisTarih" placeholder="Bitiş Tarihi">
<button id="ekleBtn">Araç Ekle</button>

<h3>Araçlar</h3>
<ul id="aracListesi"></ul>

<script>
// Araçları localStorage'da saklamak
let araclar = JSON.parse(localStorage.getItem('araclar')) || [];

function kalanGunHesapla(bitis) {
    const bugun = new Date();
    const bitisTarih = new Date(bitis);
    const fark = bitisTarih - bugun;
    return Math.ceil(fark / (1000 * 60 * 60 * 24));
}

function guncelleListe() {
    const list = document.getElementById('aracListesi');
    list.innerHTML = '';
    araclar.forEach((arac, index) => {
        const li = document.createElement('li');
        const kalan = arac.bitisTarih ? kalanGunHesapla(arac.bitisTarih) : 'Bitiş tarihi yok';
        li.innerHTML = `
            <strong>${arac.aracAdi || 'Araç'}</strong> - ${arac.plaka}<br>
            Başlangıç: ${arac.baslangicTarih || '-'}<br>
            Bitiş: ${arac.bitisTarih || '-'}<br>
            Kalan Gün: ${kalan}<br>
            <button onclick="silArac(${index})">Sil</button>
        `;
        list.appendChild(li);

        // Bitişe yakın uyarı (3 gün veya daha az)
        if (arac.bitisTarih && kalan <= 3 && kalan >=0) {
            alert(${arac.aracAdi || 'Araç'} (${arac.plaka}) bitiş tarihine ${kalan} gün kaldı!);
        }
    });
}

function silArac(index) {
    araclar.splice(index, 1);
    localStorage.setItem('araclar', JSON.stringify(araclar));
    guncelleListe();
}

document.getElementById('ekleBtn').addEventListener('click', () => {
    const aracAdi = document.getElementById('aracAdi').value;
    const plaka = document.getElementById('plaka').value;
    const baslangicTarih = document.getElementById('baslangicTarih').value;
    const bitisTarih = document.getElementById('bitisTarih').value;

    if (!plaka || !bitisTarih) {
        alert('Plaka ve bitiş tarihi zorunludur!');
        return;
    }

    araclar.push({ aracAdi, plaka, baslangicTarih, bitisTarih });
    localStorage.setItem('araclar', JSON.stringify(araclar));

    document.getElementById('aracAdi').value = '';
    document.getElementById('plaka').value = '';
    document.getElementById('baslangicTarih').value = '';
    document.getElementById('bitisTarih').value = '';

    guncelleListe();
});

// Başlangıçta listeyi göster
guncelleListe();

// Service Worker kayıt
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js')
        .then(() => console.log('Service Worker kayıtlı'))
        .catch(err => console.log('Service Worker hatası:', err));
}
</script>
</body>
</html>
