<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ara√ß Takip</title>
  <link rel="manifest" href="manifest.json">
  <style>
    body{font-family:Arial,sans-serif;padding:20px;background:#f5f7fb;color:#111;}
    h1{text-align:center;}
    .card{background:#fff;padding:15px;border-radius:8px;margin-bottom:20px;box-shadow:0 4px 12px rgba(0,0,0,0.06);}
    label{display:block;margin-top:10px;font-weight:600;}
    input{width:100%;padding:8px;margin-top:6px;border:1px solid #ddd;border-radius:4px;}
    button{width:100%;padding:12px;margin-top:12px;font-size:16px;background:#0b5fff;color:#fff;border:none;border-radius:6px;cursor:pointer;}
    button.delete{background:#dc3545;}
    .small{font-size:13px;color:#555;margin-top:6px;}
    .warning{color:#d9534f;font-weight:bold;}
  </style>
</head>
<body>
  <h1>üöó Ara√ß Takip</h1>
  <div>
    <button onclick="yeniArac()">‚ûï Yeni Ara√ß Ekle</button>
  </div>
  <div id="app"></div>
  <script>
    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('service-worker.js')
        .then(()=>console.log('Service Worker kayƒ±tlƒ±'))
        .catch(err=>console.log('Service Worker hatasƒ±:',err));
    }
    const STORAGE_KEY = 'arac_takip_list';
    let araclar = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
    function kaydetListe(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(araclar));
    }
    function kalanGun(bitis){
      const bugun = new Date();
      const bitT = new Date(bitis + 'T00:00:00');
      const diff = Math.ceil((bitT - new Date(bugun.getFullYear(),bugun.getMonth(),bugun.getDate())) / (1000*60*60*24));
      return diff;
    }
    function goster(){
      const app = document.getElementById('app');
      app.innerHTML = '';
      araclar.forEach((arac,i)=>{
        const diff = arac.bitis ? kalanGun(arac.bitis) : null;
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `
          <label>Ara√ß Adƒ±</label>
          <input type="text" value="${arac.adi}" onchange="degistir(${i},'adi',this.value)">
          <label>Plaka</label>
          <input type="text" value="${arac.plaka}" onchange="degistir(${i},'plaka',this.value)">
          <label>Ba≈ülangƒ±√ß Tarihi (opsiyonel)</label>
          <input type="date" value="${arac.bas}" onchange="degistir(${i},'bas',this.value)">
          <label>Biti≈ü Tarihi</label>
          <input type="date" value="${arac.bitis}" onchange="degistir(${i},'bitis',this.value)">
          <div class="small">${arac.bitis ? (diff>=0 ? diff + ' g√ºn kaldƒ±' : 'S√úRESƒ∞ DOLDU ‚õî') : ''} ${diff!==null && diff<=3 && diff>=0 ? '<span class="warning">‚ö†Ô∏è Yakla≈üƒ±yor!</span>' : ''}</div>
          <button class="delete" onclick="sil(${i})">üóëÔ∏è Sil</button>
        `;
        app.appendChild(div);
        if(diff!==null && diff<=3 && diff>=0 && Notification.permission==='granted'){
          new Notification(${arac.adi || 'Ara√ß'} (${arac.plaka || '-'}) biti≈üine ${diff} g√ºn kaldƒ±!);
        }
      });
      kaydetListe();
    }
    function degistir(index, alan, deger){
      araclar[index][alan] = deger;
      goster();
    }
    function sil(index){
      araclar.splice(index,1);
      goster();
    }
    function yeniArac(){
      araclar.push({adi:'',plaka:'',bas:'',bitis:''});
      goster();
    }
    document.addEventListener('DOMContentLoaded',()=>{
      if(Notification.permission!=='granted'){
        Notification.requestPermission();
      }
      goster();
    });
  </script>
</body>
</html>
